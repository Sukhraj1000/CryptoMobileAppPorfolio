<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="CryptoApp.Views.PortfolioPage"
             Title="Portfolio"
             BackgroundColor="White">

    <VerticalStackLayout Padding="20">

        <!-- User Balance -->
        <Border StrokeShape="RoundRectangle 10">
            <VerticalStackLayout Padding="10" BackgroundColor="#F5F5F5">
                <Label Text="Available Balance" FontSize="18" TextColor="Black"/>
                <Label Text="{Binding UserBalance, StringFormat='${0:N2}'}" FontSize="22" FontAttributes="Bold" TextColor="Green"/>
            </VerticalStackLayout>
        </Border>

        <!-- Refresh Portfolio Button -->
        <Button Text="Refresh Prices" Command="{Binding RefreshPortfolioCommand}"
                BackgroundColor="#007AFF" TextColor="White" Margin="0,10,0,10"/>

        <!-- Buy Section -->
        <StackLayout>
            <Picker Title="Select Crypto" ItemsSource="{Binding AvailableCryptos}" SelectedItem="{Binding SelectedBuyCrypto}" />
            <Entry Placeholder="Amount to Buy" Keyboard="Numeric" Text="{Binding BuyAmount}" />
            <Button Text="Confirm Buy" Command="{Binding BuyCryptoCommand}" BackgroundColor="Green" TextColor="White"/>
        </StackLayout>

        <!-- Portfolio Value -->
        <Border StrokeShape="RoundRectangle 10">
            <VerticalStackLayout Padding="10" BackgroundColor="#F5F5F5">
                <Label Text="Total Portfolio Value" FontSize="18" TextColor="Black"/>
                <Label Text="{Binding TotalPortfolioValue, StringFormat='${0:N2}'}" FontSize="22" FontAttributes="Bold"/>
        
                <!--  Show Weighted % Change -->
                <Label Text="{Binding PortfolioChange, StringFormat='{0:N2}% Change'}"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{Binding PortfolioChange, Converter={StaticResource PercentageColorConverter}}"/>
            </VerticalStackLayout>
        </Border>

        <!-- Holdings List -->
        <CollectionView ItemsSource="{Binding PortfolioHoldings}">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border StrokeShape="RoundRectangle 10">
                        <VerticalStackLayout Padding="10" BackgroundColor="White">
                            <Label Text="{Binding CryptoSymbol}" FontSize="18" FontAttributes="Bold"/>

                            <HorizontalStackLayout>
                                <Label Text="{Binding Amount, StringFormat='Qty: {0:N4}'}" FontSize="14"/>
                                <Label Text=" | " FontSize="14"/>
                                <Label Text="{Binding PriceAtTransaction, StringFormat='Bought: ${0:N2}'}" FontSize="14"/>
                                <Label Text=" | " FontSize="14"/>
                                <Label Text="{Binding CurrentPrice, StringFormat='Now: ${0:N2}'}" FontSize="14"/>
                            </HorizontalStackLayout>

                            <!--  Show individual % change per transaction -->
                            <Label Text="{Binding PortfolioChange, StringFormat='{0:N2}% Change'}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="{Binding PortfolioChange, Converter={StaticResource PercentageColorConverter}}"/>

                        </VerticalStackLayout>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </VerticalStackLayout>
</ContentPage>
